---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.2
  name: autoscalingpolicies.workload.serving.volcano.sh
spec:
  group: workload.serving.volcano.sh
  names:
    kind: AutoscalingPolicy
    listKind: AutoscalingPolicyList
    plural: autoscalingpolicies
    singular: autoscalingpolicy
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          AutoscalingPolicy defines the autoscaling policy configuration for model serving workloads.
          It specifies scaling rules, metrics, and behavior for automatic replica adjustment.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AutoscalingPolicySpec defines the desired state of AutoscalingPolicy.
            properties:
              behavior:
                description: Behavior defines the scaling behavior configuration for
                  both scale up and scale down operations.
                properties:
                  scaleDown:
                    description: ScaleDown defines the policy configuration for scaling
                      down (decreasing replicas).
                    properties:
                      instances:
                        default: 1
                        description: Instances defines the maximum absolute number
                          of instances to scale in a single operation.
                        format: int32
                        minimum: 0
                        type: integer
                      percent:
                        default: 100
                        description: Percent defines the maximum percentage of current
                          instances to scale in a single operation.
                        format: int32
                        maximum: 1000
                        minimum: 0
                        type: integer
                      period:
                        default: 15s
                        description: Period defines the time duration over which scaling
                          metrics are evaluated.
                        type: string
                      selectPolicy:
                        default: Or
                        description: |-
                          SelectPolicy determines the selection strategy for scaling operations.
                          'Or' means scaling is performed if either the Percent or Instances requirement is met.
                          'And' means scaling is performed only if both Percent and Instances requirements are met.
                        enum:
                        - Or
                        - And
                        type: string
                      stabilizationWindow:
                        description: StabilizationWindow defines the time window to
                          stabilize scaling actions and prevent rapid oscillations.
                        type: string
                    type: object
                  scaleUp:
                    description: ScaleUp defines the policy configuration for scaling
                      up (increasing replicas).
                    properties:
                      panicPolicy:
                        description: |-
                          PanicPolicy defines the emergency scaling policy for handling sudden traffic spikes.
                          This policy activates during rapid load surges to prevent service degradation or timeouts.
                        properties:
                          panicModeHold:
                            default: 60s
                            description: PanicModeHold defines the duration to remain
                              in panic mode before returning to normal scaling.
                            type: string
                          panicThresholdPercent:
                            default: 200
                            description: |-
                              PanicThresholdPercent defines the metric threshold percentage that triggers panic mode.
                              When metrics exceed this percentage of target values, panic mode is activated.
                            format: int32
                            maximum: 1000
                            minimum: 110
                            type: integer
                          percent:
                            default: 1000
                            description: Percent defines the maximum percentage of
                              current instances to scale up during panic mode.
                            format: int32
                            maximum: 1000
                            minimum: 0
                            type: integer
                          period:
                            description: Period defines the evaluation period for
                              panic mode scaling decisions.
                            type: string
                        required:
                        - period
                        type: object
                      stablePolicy:
                        description: |-
                          StablePolicy defines the stable scaling policy that uses average metric values over time windows.
                          This policy smooths out short-term fluctuations and avoids unnecessary frequent scaling operations.
                        properties:
                          instances:
                            default: 1
                            description: Instances defines the maximum absolute number
                              of instances to scale in a single operation.
                            format: int32
                            minimum: 0
                            type: integer
                          percent:
                            default: 100
                            description: Percent defines the maximum percentage of
                              current instances to scale in a single operation.
                            format: int32
                            maximum: 1000
                            minimum: 0
                            type: integer
                          period:
                            default: 15s
                            description: Period defines the time duration over which
                              scaling metrics are evaluated.
                            type: string
                          selectPolicy:
                            default: Or
                            description: |-
                              SelectPolicy determines the selection strategy for scaling operations.
                              'Or' means scaling is performed if either the Percent or Instances requirement is met.
                              'And' means scaling is performed only if both Percent and Instances requirements are met.
                            enum:
                            - Or
                            - And
                            type: string
                          stabilizationWindow:
                            description: StabilizationWindow defines the time window
                              to stabilize scaling actions and prevent rapid oscillations.
                            type: string
                        type: object
                    type: object
                type: object
              metrics:
                description: Metrics defines the list of metrics used to evaluate
                  scaling decisions.
                items:
                  description: AutoscalingPolicyMetric defines a metric and its target
                    value for scaling decisions.
                  properties:
                    metricName:
                      description: MetricName defines the name of the metric to monitor
                        for scaling decisions.
                      type: string
                    targetValue:
                      anyOf:
                      - type: integer
                      - type: string
                      description: TargetValue defines the target value for the metric
                        that triggers scaling operations.
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                  required:
                  - metricName
                  - targetValue
                  type: object
                minItems: 1
                type: array
              tolerancePercent:
                default: 10
                description: |-
                  TolerancePercent defines the percentage of deviation tolerated before scaling actions are triggered.
                  current_replicas represents the current number of instances, while target_replicas represents the expected number of instances calculated from monitoring metrics.
                  Scaling operations are performed only when |current_replicas - target_replicas| >= current_replicas * TolerancePercent / 100.
                format: int32
                maximum: 100
                minimum: 0
                type: integer
            required:
            - metrics
            type: object
          status:
            description: AutoscalingPolicyStatus defines the observed state of AutoscalingPolicy.
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
